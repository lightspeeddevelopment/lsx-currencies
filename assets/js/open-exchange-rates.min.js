!function(){var r={};r.version="0.3",r.api_url="http://openexchangerates.org/api/",r.base="USD",r.rates={},r.error="",r.set=function(e){return r.app_id=e.app_id,r},r.latest=function(e){return r.load("latest.json",e),r},r.historical=function(e,t){return r.load("historical/"+e+".json",t),r},r.load=function(e,t){"function"==typeof e&&(t=e),e="string"==typeof e?e:"latest.json";var a=r.api_url+e+"?app_id="+r.app_id,o=require("http-agent").create("",[{method:"GET",uri:a}]);return o.addListener("next",function(e,a){var o=a&&a.body?a.body:null;r.error=e,r.error||r.parse.call(r,o,r),"function"==typeof t&&t(r.error,o)}),o.start(),r},r.parse=function(r,e){try{r=JSON.parse(r)}catch(t){return e.error="Module error in parsing JSON data: "+t.toString(),e}return r&&r.error?(e.error=r.status+" ("+r.message+"): "+r.description,e):(r&&r.base&&r.rates?(e.base=r.base,e.rates=r.rates,e.timestamp=1e3*r.timestamp):e.error="No rates or base currency returned from API",e)},module.exports=r}();